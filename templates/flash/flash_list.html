{% extends "base/base.html" %}
{% load static %}

{% block head %} 
<link rel="stylesheet" href="{% static 'flash/flash_list.css' %}">
<script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDZLQne-DOUQDfifh3ZP_79TmL2OmBOI7k&libraries=places&callback=initMap"></script>
<script defer src="{% static 'flash/flash_map_list.js' %}"></script>
{% endblock %}

{% block header_content %}
<a id="myPage" href="#">My Page</a>
{% endblock %}

{% block content %}
<!-- ì§€ë„ ìœ„ ë¬¸êµ¬ -->
<section class="flash_title">
    <h2>ì—¬í–‰ ì† ë°˜ì§ì´ëŠ” ë§Œë‚¨, <a href="{% url 'flash:flash_list' %}" class="highlight">ë²ˆê°œ ëª¨ì„</a></h2>
</section>
<div class="flash_searchBar">
    <form method='GET' class="flash_filter">
        {% csrf_token %}
        <div class="flash_filter_content">
            <div class="filter-group">
                {{filterset.form.title}}
            </div>
            <div class="filter-group">
                {{filterset.form.tags}}
            </div>
            <div class="filter-group">
                {{filterset.form.date_time}}
            </div>
        </div>
        <button type="submit">ê²€ìƒ‰</button>
    </form>
</div>
<div class="flash_container">
    <!-- ì§€ë„ -->
    <div class="flash_left">
        <section class="flash_list_header">
            <h2 class="flash_list_title">{{ flash_meetings.count }}ê°œì˜ ëª¨ì§‘ì¤‘ì¸ ë²ˆê°œ</h2>
            <div class="flash_list_controls">
                <h2>ë‚˜ë§Œì˜ ë²ˆê°œ</h2>
                <a href="{% url 'flash:flash_register' %}" class="flash_register_btn">ë“±ë¡í•˜ê¸°</a>
            </div>
        </section>
        
        <!-- êµ¬ë¶„ì„  -->
        <hr class="flash_list_divider">
        
        <!-- ëª¨ì§‘ ì¤‘ì¸ ë²ˆê°œ ë¦¬ìŠ¤íŠ¸ -->        
        <section class="flash_list">
            <section class="flash_list_body">
                {% for flash in flash_meetings %}
                <div class="flash_card"
                    data-lat="{{ flash.latitude }}"
                    data-lng="{{ flash.longitude }}"
                    data-date="{{ flash.date_time|date:'Y-m-d H:i' }}"
                    data-place-address="{{ flash.city }}">
                    <a href="{% url 'flash:flash_detail' flash.meeting_id %}">
                        <img id="place-img-{{ flash.meeting_id }}" src="https://via.placeholder.com/300" alt="ëª¨ì„ ì´ë¯¸ì§€">
                    </a>
                    <div class ="flash_card_content">
                        <div class="flash_card_info">
                            <h3><a href="{% url 'flash:flash_detail' flash.meeting_id %}">{{flash.title}}</a></h3>
                            <p class="flash_date">{{ flash.date_time|date:"Yë…„ mì›” dì¼ H:i" }}</p>
                            <p class="flash_place">{{ flash.city }}</p>
                        </div>
                        <div class="flash_card_tags">
                                {% for tag in flash.tag_list %}
                                    <span class="flash_tag">#{{ tag }}</span>
                                {% empty %}
                                    <span class="flash_tag">íƒœê·¸ ì—†ìŒ</span>
                                {% endfor %}
                                <span class="flash_capacity">{{ flash.max_people }}</span>
                        </div>
                    </div>
                </div>
                {% empty %}
                <p>ë“±ë¡ëœ ë²ˆê°œ ëª¨ì„ì´ ì—†ìŠµë‹ˆë‹¤.</p>
                {% endfor %}
            </section>
            
        </section>
    </div>

    <section class="flash_map">
        <input id="search-bar" type="text" placeholder="ì¥ì†Œë¥¼ ê²€ìƒ‰í•˜ì„¸ìš”">
        <div id="map"></div>
    </section>
    
</div>

<script>
    window.initMap = function () {
        console.log("âš¡ Google Maps API ë¡œë“œë¨: initMap ì‹¤í–‰");
        if (typeof window.actualInitMap === "function") {
            window.actualInitMap();
        } else {
            console.error("ğŸš¨ actualInitMap í•¨ìˆ˜ê°€ ì •ì˜ë˜ì§€ ì•ŠìŒ!");
        }
    };
</script>

{% endblock %}
