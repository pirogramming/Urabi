{% extends "base/base.html" %}
{% load static %}

{% block head %} 
<link rel="stylesheet" href="{% static 'flash/flash_list.css' %}">
<script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDZLQne-DOUQDfifh3ZP_79TmL2OmBOI7k&callback=initMap"></script>
{% endblock %}

{% block header_content %}
<a id="myPage" href="#">My Page</a>
{% endblock %}

{% block content %}
<!-- ì§€ë„ ìœ„ ë¬¸êµ¬ -->
<section class="flash_title">
    <h2>ì—¬í–‰ ì† ë°˜ì§ì´ëŠ” ë§Œë‚¨, <span class="highlight">ë²ˆê°œ ëª¨ì„</span> > ë²ˆê°œ ì°¾ê¸°</h2>
</section>

<div class="flash_container">
    <!-- ì§€ë„ -->
    <div class="flash_left">
        <section class="flash_list_header">
            <h2 class="flash_list_title">12ê°œì˜ ëª¨ì§‘ì¤‘ì¸ ë²ˆ ê°œ</h2>
            <div class="flash_list_controls">
                <h2>ë‚˜ë§Œì˜ ë²ˆê°œ</h2>
                <a href="{% url 'flash:flash_register' %}" class="flash_register_btn">ë“±ë¡í•˜ê¸°</a>
            </div>
        </section>
        
        <!-- êµ¬ë¶„ì„  -->
        <hr class="flash_list_divider">
        
        <!-- ëª¨ì§‘ ì¤‘ì¸ ë²ˆê°œ ë¦¬ìŠ¤íŠ¸ -->        
        <section class="flash_list">
            <section class="flash_list_body">
                <div class="flash_card">
                    <a href="{% url 'flash:flash_detail' pk=1 %}" class="flash_card_link">
                        <img src="{% static 'img/flash_meeting1.png' %}" alt="ëª¨ì„ ì´ë¯¸ì§€">
                        <div class="flash_card_info">
                            <h3>í† íŠ¸ë„˜ ê²½ê¸°ë³´ë©´ì„œ ë§¥ì£¼ ë“œì‹¤ ë¶„~</h3>
                            <p class="flash_place">123 High Street,London, SW1A 1AA United Kingdom</p>
                            <p class="flash_date">2025ë…„ 01ì›” 11ì¼ 12:00</p>
                            <div class="flash_card_tags">
                                <span class="flash_tag">#ë‚¨ë…€ë¬´ê´€</span>
                                <span class="flash_tag">#íƒ€íŒ¬í™˜ì˜</span>
                                <span class="flash_capacity">1/4</span>
                            </div>
                        </div>
                    </a>
                </div>
                {% for flash in flash_meetings %}
                <div class="flash_card">
                    <a href="{% url 'flash:flash_detail' flash.meeting_id %}">
                        <img src="{% static 'img/flash_meeting1.png' %}" alt="ëª¨ì„ ì´ë¯¸ì§€">
                    </a>
                    <div class="flash_card_info">
                        <h3><a href="{% url 'flash:flash_detail' flash.meeting_id %}">{{ flash.title }}</a></h3>
                        <p class="flash_place">{{ flash.city }}</p>
                        <p class="flash_date">{{ flash.date_time|date:"Yë…„ mì›” dì¼ H:i" }}</p>
                        <div class="flash_card_tags">
                            {% for tag in flash.tag_list %}
                                <span class="flash_tag">#{{ tag }}</span>
                            {% empty %}
                                <span class="flash_tag">íƒœê·¸ ì—†ìŒ</span>
                            {% endfor %}
                        </div>
                        <span class="flash_capacity">{{ flash.max_people }}</span>
                    </div>
                </div>
                {% empty %}
                <p>ë“±ë¡ëœ ë²ˆê°œ ëª¨ì„ì´ ì—†ìŠµë‹ˆë‹¤.</p>
                {% endfor %}
            </section>
            
        </section>
    </div>

    <section class="flash_map">
        <div id="map"></div>
    </section>
    
</div>

<script>
    function initMap() {
        const dafualt_place = { lat: 37.5665, lng: 126.9780 };  // ê¸°ë³¸ ì§€ë„ ìœ„ì¹˜ (ì„œìš¸)
        const map = new google.maps.Map(document.getElementById("map"), {
            zoom: 12,
            center: dafualt_place
        });

        const flashMeetings = [
            {% for flash in flash_meetings %}
                { lat: {{ flash.latitude }},
                  lng: {{ flash.longitude }},
                  title: "{{ flash.title }}" ,
                  date: "{{ flash.date_time|date:'Y-m-d H:i' }}",
                  url: "{% url 'flash:flash_detail' flash.meeting_id %}"
                },
            {% endfor %}
        ];

        flashMeetings.forEach(meeting => {
            const marker = new google.maps.Marker({
                position: { lat: meeting.lat, lng: meeting.lng },
                map,
                title: meeting.title
            });

            const infoWindow = new google.maps.InfoWindow({
                content: `<div>
                            <h3>${meeting.title}</h3>
                            <p>ğŸ“… ${meeting.date}</p>
                            <a href="${meeting.url}" target="_blank">ìƒì„¸ë³´ê¸°</a>
                          </div>`,
            });
            /* ë§ˆì»¤ í´ë¦­ ì‹œ infowindow*/
            marker.addListener("click", function() {
                infoWindow.open(map, marker);
            });
        });
    }
</script>

{% endblock %}
